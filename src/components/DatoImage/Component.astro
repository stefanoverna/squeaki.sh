---
import { readFragment, type FragmentOf } from '~/lib/datocms/graphql';
import { ImageBlockFragment } from './graphql';
import { Image } from '@datocms/astro';

type Props = {
  block: FragmentOf<typeof ImageBlockFragment>;
};

const { block: maskedBlock } = Astro.props;
const block = readFragment(ImageBlockFragment, maskedBlock);
---

{
  block.image.responsiveImage.height / block.image.responsiveImage.width > 1 ? (
    <div
      class="spacer compact-media-preview"
      style={{ backgroundImage: `url(${block.image.responsiveImage.base64})` }}
    >
      <div
        class="compact-media-preview__spacer"
        style={{
          aspectRatio: block.image.responsiveImage.width / block.image.responsiveImage.height,
        }}
      >
        <a href={block.image.responsiveImage.src} target="_blank">
          <Image data={block.image.responsiveImage} />
        </a>
      </div>
    </div>
  ) : (
    <a href={block.image.responsiveImage.src} target="_blank">
      <Image data={block.image.responsiveImage} />
    </a>
  )
}

<style>
  .spacer {
    margin: var(--double-space) 0;
  }

  .compact-media-preview {
    background-size: cover;
    background-position: center;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 10px;
    border-radius: 5px;
  }

  .compact-media-preview__spacer {
    height: 500px;
    max-height: 55vh;
    position: relative;
    box-shadow:
      0px 0px 1.8px rgba(var(--rgb-ink), 0.07),
      0px 0px 4.3px rgba(var(--rgb-ink), 0.101),
      0px 0px 8px rgba(var(--rgb-ink), 0.125),
      0px 0px 14.3px rgba(var(--rgb-ink), 0.149),
      0px 0px 26.7px rgba(var(--rgb-ink), 0.18),
      0px 0px 64px rgba(var(--rgb-ink), 0.25);
  }
</style>
